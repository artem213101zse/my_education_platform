{% extends 'education/base.html' %}

{% block content %}
<div class="container my-5">
    <h1 class="text-dark fw-bold mb-4">Результаты теста "{{ quiz.title }}"</h1>
    <div class="card shadow-lg border-0 rounded-4 p-4 bg-white">
        {% if is_teacher and not preview_mode %}
        <!-- Для учителя: результаты всех студентов -->
        <h3 class="text-dark fw-bold mb-4">Результаты студентов</h3>
        {% if results %}
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Студент</th>
                    <th>Правильных ответов</th>
                    <th>Всего ответов</th>
                    <th>Процент</th>
                </tr>
            </thead>
            <tbody>
                {% for result in results %}
                <tr>
                    <td>{{ result.student.user.username }}</td>
                    <td>{{ result.correct }}</td>
                    <td>{{ result.total }}</td>
                    <td>{{ result.percentage|floatformat:1 }}%</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p class="text-muted">Ещё никто не прошёл этот тест.</p>
        {% endif %}
        {% else %}
        <!-- Для студента или учителя в режиме предпросмотра: его прогресс -->
        <h3 class="text-dark fw-bold mb-4">Ваш прогресс</h3>
        {% if preview_mode %}
        <p class="text-muted">Это предпросмотр. Ваши ответы не сохраняются.</p>
        {% endif %}
        {% if progress.total_answered > 0 %}
        <p>Правильных ответов: {{ progress.correct }} из {{ progress.total_questions }}</p>
        <p>Процент: {{ progress.percentage|floatformat:1 }}%</p>
        <h4 class="text-dark fw-bold mt-4">Ваши ответы:</h4>
        <ul class="list-group">
            {% for answer in progress.answers %}
            <li class="list-group-item {% if answer.is_correct %}list-group-item-success{% else %}list-group-item-danger{% endif %}">
                <strong>{{ answer.question.text }}</strong><br>
                Ваш ответ: {{ answer.answer_text }}<br>
                Правильный ответ: {{ answer.question.correct_answer }}
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p class="text-muted">Вы ещё не начали проходить тест.</p>
        {% endif %}
        {% endif %}
        <a href="{% url 'quiz_detail' quiz.id 0 %}{% if preview_mode %}?preview=true{% endif %}" class="btn btn-primary rounded-pill px-4 py-2 mt-3">Вернуться к тесту</a>
        <a href="{% url 'module_detail' quiz.module.id %}" class="btn btn-secondary rounded-pill px-4 py-2 mt-3">Вернуться к модулю</a>
    </div>
</div>
{% endblock %}